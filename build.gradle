plugins {
    id 'java'
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.1.0'
}

group = 'com.whispr'
version = '0.1'

repositories {
    mavenCentral()
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

javafx {
    version = "21"
    modules = [ 'javafx.controls', 'javafx.fxml' ]
}

dependencies {
    // MaterialFX
    implementation 'io.github.palexdev:materialfx:11.17.0'

    // Twoje pozostałe zależności (Gson, SQLite, BCrypt, Logback)
    implementation 'com.google.code.gson:gson:2.13.1'
    implementation 'org.xerial:sqlite-jdbc:3.45.1.0'
    implementation 'org.mindrot:jbcrypt:0.4'
    implementation 'ch.qos.logback:logback-classic:1.5.13'

    // Zależności testowe
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.10.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.10.0'
}

// Konfiguracja dla głównego zadania 'run', które uruchomi panel admina
application {
    mainClass = 'com.whispr.securechat.admin.gui.AdminApplication'
    // mainModule usunięty dla uproszczenia, odkomentuj jeśli używasz module-info.java
    // mainModule = 'com.whispr.securechat'
}

// Twoje własne zadania do uruchamiania klas bez GUI - z poprawionymi ścieżkami
tasks.register('runServer', JavaExec) {
    group = 'Uruchomienie' // Lepsza grupa dla przejrzystości w IDE
    description = 'Uruchamia serwer czatu (bez GUI)'
    mainClass = 'com.whispr.securechat.server.ChatServer'
    classpath = sourceSets.main.runtimeClasspath
}

tasks.register('runChatClient', JavaExec) {
    group = 'Uruchomienie'
    description = 'Uruchamia testowego klienta w konsoli'
    mainClass = 'com.whispr.securechat.client.ChatClient'
    classpath = sourceSets.main.runtimeClasspath
}

tasks.register('runRSAEncryptionUtil', JavaExec) {
    group = 'Narzędzia'
    description = 'Uruchamia test szyfrowania RSA'
    mainClass = 'com.whispr.securechat.security.RSAEncryptionUtil' // POPRAWIONE
    classpath = sourceSets.main.runtimeClasspath
}

tasks.register('runAESEncryptionUtil', JavaExec) {
    group = 'Narzędzia'
    description = 'Uruchamia test szyfrowania AES'
    mainClass = 'com.whispr.securechat.security.AESEncryptionUtil' // POPRAWIONE
    classpath = sourceSets.main.runtimeClasspath
}

tasks.register('runClient', JavaExec) {
    group = "Application"
    description = "Runs the interactive terminal client"
    mainClass = 'com.whispr.securechat.client.ChatClient'
    classpath = sourceSets.main.runtimeClasspath
    // This is essential to make the terminal client interactive
    standardInput = System.in
}

test {
    useJUnitPlatform()
}